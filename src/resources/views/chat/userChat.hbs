<div class="chat-wrapper">
    <div class="chat-header">ðŸ’¬ Chat há»— trá»£</div>

    <div id="chat-box" class="chat-box">
        {{#each messages}}
            <div class="msg-row {{#if (eq senderId ../userId)}}right{{else}}left{{/if}}">
                <div class="bubble">
                    <span>{{message}}</span>
                    <div class="time">{{formatDate createdAt}}</div>
                </div>
            </div>
        {{/each}}
    </div>

    <div class="chat-input">
        <input id="msg" placeholder="Nháº­p tin nháº¯n..." />
        <button id="sendBtn">Gá»­i</button>
    </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const chatBox = document.getElementById("chat-box");  // <--- thÃªm
socket.emit("register", { userId: {{userId}} });

document.getElementById("sendBtn").onclick = send;
document.getElementById("msg").addEventListener("keyup", e => {
    if (e.key === "Enter") send();
});

function send() {
    const msgInput = document.getElementById("msg");   // <--- thÃªm
    let msg = msgInput.value.trim();
    if (!msg) return;

    socket.emit("userMessage", { userId: {{userId}}, message: msg });
    appendMessage(msg, "right");
    msgInput.value = "";
}

socket.on("receiveMessage", data => {
    appendMessage(data.message, data.isAdmin ? "left" : "right");
});

function appendMessage(text, side) {
    const div = document.createElement("div");
    div.className = "msg-row " + side;
    div.innerHTML = `
        <div class="bubble">
            ${text}
            <div class="time">${new Date().toLocaleTimeString()}</div>
        </div>`;
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}
</script>

<style>
.chat-wrapper {
    width: 100%;
    max-width: 450px;
    margin: 0 auto;
    height: 88vh;
    display: flex;
    flex-direction: column;
    border: 1px solid #ddd;
    border-radius: 12px;
    background: #fff;
}

.chat-header {
    padding: 14px;
    background: #343a40;
    color: #fff;
    text-align: center;
    font-size: 18px;
    border-radius: 12px 12px 0 0;
}

.chat-box {
    flex: 1;
    padding: 15px;
    background: #f7f7f7;
    overflow-y: auto;
}

.msg-row {
    display: flex;
    margin-bottom: 12px;
}

.msg-row.right {
    justify-content: flex-end;
}

.msg-row.left {
    justify-content: flex-start;
}

.bubble {
    max-width: 70%;
    padding: 10px 14px;
    border-radius: 18px;
    background: #e6e6e6;
    position: relative;
}

.right .bubble {
    background: #343a40;
    color: #fff;
    border-bottom-right-radius: 4px;
}

.left .bubble {
    background: #fff;
    border: 1px solid #ddd;
    border-bottom-left-radius: 4px;
}

.time {
    margin-top: 4px;
    font-size: 11px;
    opacity: 0.6;
    text-align: right;
}

.chat-input {
    display: flex;
    padding: 10px;
    border-top: 1px solid #ddd;
    background: #fff;
}

.chat-input input {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #aaa;
}

.chat-input button {
    margin-left: 8px;
    padding: 10px 14px;
    background: #343a40;
    border: none;
    color: white;
    border-radius: 8px;
    cursor: pointer;
}
</style>
